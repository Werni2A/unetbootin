name: Build

on: [push, pull_request]

env:
  # Customize the CMake build type here (Release, Debug, RelWithDebInfo, etc.)
  BUILD_TYPE: Debug
  PLATFORM: EEEUBUNTU # FIXME: This is just a placeholder. CMake does not respect this kind of defines yet

jobs:
  # build_ubuntu:
  #   runs-on: ${{matrix.os}}

  #   strategy:
  #     matrix:
  #       os: [ubuntu-18.04, ubuntu-20.04]
  #       platform: [AUTOSUPERGRUBDISK, EEEPCLOS, EEEUBUNTU, ELIVE, GNEWSENSE, KIWILINUX, NIMBLEX, SLITAZ, XPUD]

  #   steps:
  #   - uses: actions/checkout@v2

  #   - name: Set Up Build Environment
  #     working-directory: ${{github.workspace}}/src/unetbootin
  #     shell: bash
  #     run: |
  #       sudo apt-get install -y build-essential cmake qtbase5-dev qttools5-dev
  #       mkdir -p build_tmp

  #   - name: Build UNetbootin
  #     working-directory: ${{github.workspace}}/src/unetbootin/build_tmp
  #     shell: bash
  #     run: |
  #       cmake .. -DCMAKE_BUILD_TYPE=$BUILD_TYPE -DPLATFORM=${{matrix.platform}}
  #       make

  build_windows:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v2

    - name: Set Up Build Environment
      working-directory: ${{github.workspace}}/src/unetbootin
      shell: cmd
      run: |
        # choco install cmake.install
        # choco install mingw
        mkdir build_tmp

    - name: Install Qt
      uses: jurplel/install-qt-action@v2
      with:
        version: '5.15.2'
        host: 'windows'
        target: 'desktop'
        arch: 'win64_msvc2017_64'
        dir: '${{ github.workspace }}/example/'
        install-deps: 'true'
        modules: 'qtcharts qtwebengine'
        cached: 'false'
        setup-python: 'false'
        tools: 'tools_ifw,4.0,qt.tools.ifw.40 tools_qtcreator,4.13.2-0,qt.tools.qtcreator'
        set-env: 'false'
        tools-only: 'false'


    - name: Build UNetbootin
      working-directory: ${{github.workspace}}/src/unetbootin/build_tmp
      shell: cmd
      run: |
        cmake -G "MinGW Makefiles" .. -DCMAKE_BUILD_TYPE=$BUILD_TYPE
        mingw-make